#!/bin/bash

DIR="pokemon_data"
CSV_FILE="pokemon_report.csv"

echo "Name,Height (m),Weight (kg)" > "$CSV_FILE"

total_height=0
total_weight=0
count=0

for file in "$DIR"/*.json; do
    name=$(jq -r '.name' "$file")
    height_dm=$(jq -r '.height' "$file")
    weight_hg=$(jq -r '.weight' "$file")

    height=$(echo "scale=1; $height_dm / 10" | bc)
    weight=$(echo "scale=1; $weight_hg / 10" | bc)

    echo "${name^},$height,$weight" >> "$CSV_FILE"  # capitalize first letter

    total_height=$(echo "$total_height + $height" | bc)
    total_weight=$(echo "$total_weight + $weight" | bc)
    ((count++))
done

avg_height=$(echo "scale=2; $total_height / $count" | bc)
avg_weight=$(echo "scale=2; $total_weight / $count" | bc)

echo -e "\nAverage Height: $avg_height m"
echo "Average Weight: $avg_weight kg"
echo "CSV Report generated at: $CSV_FILE"
